{"dependencies":[{"name":"unfetch","isAsync":false},{"name":"../constants/environments","isAsync":false}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, module, exports, _dependencyMap) {\n  'use strict';\n\n  exports.__esModule = true;\n  exports.sendIWCS = exports.sendPostToWebserv = exports.sendPostToAPI = undefined;\n\n  var _serverUrl, _apiUrl;\n\n  var _unfetch = _$$_REQUIRE(_dependencyMap[0], 'unfetch');\n\n  var _unfetch2 = _interopRequireDefault(_unfetch);\n\n  var _environments = _$$_REQUIRE(_dependencyMap[1], '../constants/environments');\n\n  function _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : {\n      default: obj\n    };\n  }\n\n  var serverUrl = (_serverUrl = {}, _serverUrl[_environments.LABS] = 'https://secure-labs.livechatinc.com', _serverUrl[_environments.STAGING] = 'https://secure-lc.livechatinc.com', _serverUrl[_environments.PRODUCTION] = 'https://secure.livechatinc.com', _serverUrl);\n  var apiUrl = (_apiUrl = {}, _apiUrl[_environments.LABS] = 'https://api.labs.livechatinc.com', _apiUrl[_environments.STAGING] = 'https://api.staging.livechatinc.com', _apiUrl[_environments.PRODUCTION] = 'https://api.livechatinc.com', _apiUrl);\n\n  var getServerUrl = function getServerUrl(environment, license) {\n    if (license === 1520) {\n      return serverUrl[_environments.STAGING];\n    }\n\n    return serverUrl[environment];\n  };\n\n  var getAPIUrl = function getAPIUrl(environment, license) {\n    if (license === 1520) {\n      return apiUrl[_environments.STAGING];\n    }\n\n    return apiUrl[environment];\n  };\n\n  var generateRandomId = function generateRandomId(size) {\n    var randomId = '';\n    var chars = '0123456789abcdefghijklmnopqurstuvwxyzABCDEFGHIJKLMNOPQURSTUVWXYZ';\n\n    for (var counter = 0; counter < size; counter++) {\n      randomId += chars.substr(Math.floor(Math.random() * chars.length), 1);\n    }\n\n    return randomId;\n  };\n\n  var fetchWithRetry = function fetchWithRetry(url, body) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var attempts = options.attempts || 3;\n    var retryDelay = options.retryDelay || 1000;\n    return new Promise(function (resolve, reject) {\n      var fetchRequest = function fetchRequest() {\n        (0, _unfetch2.default)(url, body).then(function (response) {\n          return resolve(response);\n        }).catch(function (error) {\n          if (attempts) {\n            --attempts;\n            return setTimeout(function () {\n              fetchRequest();\n            }, retryDelay);\n          }\n\n          return reject(error);\n        });\n      };\n\n      fetchRequest();\n    });\n  };\n\n  var sendPostToAPI = exports.sendPostToAPI = function sendPostToAPI(methodName, _ref, options) {\n    var environment = _ref.environment,\n        license = _ref.license,\n        body = _ref.body;\n    var requestUrl = getAPIUrl(environment, license) + '/' + methodName;\n    return fetchWithRetry(requestUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      credentials: 'include',\n      body: JSON.stringify(body)\n    }, options).then(function (response) {\n      return response.json();\n    });\n  };\n\n  var sendPostToWebserv = exports.sendPostToWebserv = function sendPostToWebserv(methodName, _ref2, options) {\n    var environment = _ref2.environment,\n        license = _ref2.license,\n        body = _ref2.body,\n        securedToken = _ref2.securedToken,\n        secretId = _ref2.secretId;\n    var webservPart = methodName === 'status_ping' || methodName.indexOf('get_static_config') !== -1 ? 'v2/' : '';\n    var requestUrl = getServerUrl(environment, license) + '/licence/external/' + license + '/' + webservPart + methodName;\n\n    if (securedToken) {\n      requestUrl += '?secret_token=' + securedToken;\n    }\n\n    if (secretId) {\n      requestUrl += '&secret_id=' + secretId;\n    }\n\n    return fetchWithRetry(requestUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      credentials: 'include',\n      body: JSON.stringify(body)\n    }, options).then(function (response) {\n      return response.json();\n    });\n  };\n\n  var sendIWCS = exports.sendIWCS = function sendIWCS(environment, licenseNumber, command, securedToken, secretId) {\n    var requestUrl = getServerUrl(environment, licenseNumber) + '/licence/external/' + licenseNumber + '/tunnel_callback.cgi?' + generateRandomId(20);\n\n    if (securedToken) {\n      requestUrl += '&secret_token=' + securedToken;\n    }\n\n    if (secretId) {\n      requestUrl += '&secret_id=' + secretId;\n    }\n\n    requestUrl += '&command=' + encodeURI(command);\n    return fetchWithRetry(requestUrl, {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      credentials: 'include'\n    }).then(function (response) {\n      return response.text();\n    }).then(function (responseText) {\n      return responseText.split('^');\n    });\n  };\n});","map":[[2,0,1,0],[4,0,3,0,"exports"],[4,10,3,8,"__esModule"],[4,20,3,0],[4,23,3,21],[4,27,3,0],[5,0,4,0,"exports"],[5,10,4,8,"sendIWCS"],[5,18,4,0],[5,21,4,19,"exports"],[5,29,4,27,"sendPostToWebserv"],[5,46,4,19],[5,49,4,47,"exports"],[5,57,4,55,"sendPostToAPI"],[5,70,4,47],[5,73,4,71,"undefined"],[5,82,4,0],[7,0,6,0],[7,6,6,4,"_serverUrl"],[7,16,6,0],[7,18,6,16,"_apiUrl"],[7,25,6,0],[9,0,8,0],[9,6,8,4,"_unfetch"],[9,17,8,15,"require"],[9,48,8,23],[9,57,8,15],[9,58,8,0],[11,0,10,0],[11,6,10,4,"_unfetch2"],[11,18,10,16,"_interopRequireDefault"],[11,41,10,39,"_unfetch"],[11,49,10,16],[11,50,10,0],[13,0,12,0],[13,6,12,4,"_environments"],[13,22,12,20,"require"],[13,53,12,28],[13,80,12,20],[13,81,12,0],[15,0,14,0],[15,11,14,9,"_interopRequireDefault"],[15,33,14,0],[15,34,14,32,"obj"],[15,37,14,0],[15,39,14,37],[16,0,14,39],[16,11,14,46,"obj"],[16,18,14,53,"obj"],[16,22,14,57,"__esModule"],[16,32,14,46],[16,35,14,70,"obj"],[16,38,14,46],[16,41,14,76],[17,0,14,78,"default"],[17,15,14,87,"obj"],[18,0,14,76],[18,5,14,39],[19,0,14,95],[21,0,16,0],[21,6,16,4,"serverUrl"],[21,19,16,17,"_serverUrl"],[21,32,16,30],[21,34,16,17],[21,36,16,34,"_serverUrl"],[21,47,16,45,"_environments"],[21,61,16,59,"LABS"],[21,65,16,34],[21,69,16,67],[21,106,16,17],[21,108,16,106,"_serverUrl"],[21,119,16,117,"_environments"],[21,133,16,131,"STAGING"],[21,140,16,106],[21,144,16,142],[21,179,16,17],[21,181,16,179,"_serverUrl"],[21,192,16,190,"_environments"],[21,206,16,204,"PRODUCTION"],[21,216,16,179],[21,220,16,218],[21,252,16,17],[21,254,16,252,"_serverUrl"],[21,264,16,4],[21,265,16,0],[22,0,18,0],[22,6,18,4,"apiUrl"],[22,16,18,14,"_apiUrl"],[22,26,18,24],[22,28,18,14],[22,30,18,28,"_apiUrl"],[22,38,18,36,"_environments"],[22,52,18,50,"LABS"],[22,56,18,28],[22,60,18,58],[22,94,18,14],[22,96,18,94,"_apiUrl"],[22,104,18,102,"_environments"],[22,118,18,116,"STAGING"],[22,125,18,94],[22,129,18,127],[22,166,18,14],[22,168,18,166,"_apiUrl"],[22,176,18,174,"_environments"],[22,190,18,188,"PRODUCTION"],[22,200,18,166],[22,204,18,202],[22,233,18,14],[22,235,18,233,"_apiUrl"],[22,242,18,4],[22,243,18,0],[24,0,20,0],[24,6,20,4,"getServerUrl"],[24,21,20,19],[24,30,20,28,"getServerUrl"],[24,42,20,19],[24,43,20,41,"environment"],[24,54,20,19],[24,56,20,54,"license"],[24,63,20,19],[24,65,20,63],[25,0,21,1],[25,8,21,5,"license"],[25,20,21,17],[25,24,21,1],[25,26,21,23],[26,0,22,2],[26,13,22,9,"serverUrl"],[26,23,22,19,"_environments"],[26,37,22,33,"STAGING"],[26,44,22,9],[26,45,22,2],[27,0,23,2],[29,0,24,1],[29,11,24,8,"serverUrl"],[29,21,24,18,"environment"],[29,32,24,8],[29,33,24,1],[30,0,25,1],[30,3,20,0],[32,0,27,0],[32,6,27,4,"getAPIUrl"],[32,18,27,16],[32,27,27,25,"getAPIUrl"],[32,36,27,16],[32,37,27,35,"environment"],[32,48,27,16],[32,50,27,48,"license"],[32,57,27,16],[32,59,27,57],[33,0,28,1],[33,8,28,5,"license"],[33,20,28,17],[33,24,28,1],[33,26,28,23],[34,0,29,2],[34,13,29,9,"apiUrl"],[34,20,29,16,"_environments"],[34,34,29,30,"STAGING"],[34,41,29,9],[34,42,29,2],[35,0,30,2],[37,0,31,1],[37,11,31,8,"apiUrl"],[37,18,31,15,"environment"],[37,29,31,8],[37,30,31,1],[38,0,32,1],[38,3,27,0],[40,0,34,0],[40,6,34,4,"generateRandomId"],[40,25,34,23],[40,34,34,32,"generateRandomId"],[40,50,34,23],[40,51,34,49,"size"],[40,55,34,23],[40,57,34,55],[41,0,35,1],[41,8,35,5,"randomId"],[41,19,35,16],[41,21,35,1],[42,0,36,1],[42,8,36,5,"chars"],[42,16,36,13],[42,82,36,1],[44,0,38,1],[44,9,38,6],[44,13,38,10,"counter"],[44,23,38,20],[44,24,38,1],[44,26,38,23,"counter"],[44,36,38,33,"size"],[44,40,38,1],[44,42,38,39,"counter"],[44,51,38,1],[44,53,38,50],[45,0,39,2,"randomId"],[45,18,39,14,"chars"],[45,24,39,20,"substr"],[45,30,39,14],[45,31,39,27,"Math"],[45,36,39,32,"floor"],[45,41,39,27],[45,42,39,38,"Math"],[45,47,39,43,"random"],[45,53,39,38],[45,58,39,54,"chars"],[45,64,39,60,"length"],[45,70,39,27],[45,71,39,14],[45,73,39,69],[45,74,39,14],[45,75,39,2],[46,0,40,2],[48,0,42,1],[48,11,42,8,"randomId"],[48,19,42,1],[49,0,43,1],[49,3,34,0],[51,0,45,0],[51,6,45,4,"fetchWithRetry"],[51,23,45,21],[51,32,45,30,"fetchWithRetry"],[51,46,45,21],[51,47,45,45,"url"],[51,50,45,21],[51,52,45,50,"body"],[51,56,45,21],[51,58,45,56],[52,0,46,1],[52,8,46,5,"options"],[52,18,46,15,"arguments"],[52,28,46,25,"length"],[52,34,46,15],[52,37,46,34],[52,38,46,15],[52,42,46,39,"arguments"],[52,52,46,49],[52,53,46,39],[52,59,46,56,"undefined"],[52,68,46,15],[52,71,46,68,"arguments"],[52,81,46,78],[52,82,46,68],[52,83,46,15],[52,86,46,83],[52,88,46,1],[53,0,48,1],[53,8,48,5,"attempts"],[53,19,48,16,"options"],[53,27,48,24,"attempts"],[53,35,48,16],[53,39,48,36],[53,40,48,1],[54,0,49,1],[54,8,49,5,"retryDelay"],[54,21,49,18,"options"],[54,29,49,26,"retryDelay"],[54,39,49,18],[54,43,49,40],[54,47,49,1],[55,0,50,1],[55,11,50,8],[55,15,50,12,"Promise"],[55,22,50,8],[55,23,50,20],[55,33,50,30,"resolve"],[55,40,50,20],[55,42,50,39,"reject"],[55,48,50,20],[55,50,50,47],[56,0,51,2],[56,10,51,6,"fetchRequest"],[56,25,51,21],[56,34,51,30,"fetchRequest"],[56,46,51,21],[56,49,51,45],[57,0,52,3],[57,9,52,4],[57,12,52,7,"_unfetch2"],[57,22,52,17,"default"],[57,29,52,3],[57,31,52,26,"url"],[57,34,52,3],[57,36,52,31,"body"],[57,40,52,3],[57,42,52,37,"then"],[57,46,52,3],[57,47,52,42],[57,57,52,52,"response"],[57,65,52,42],[57,67,52,62],[58,0,53,4],[58,17,53,11,"resolve"],[58,25,53,19,"response"],[58,33,53,11],[58,34,53,4],[59,0,54,4],[59,9,52,3],[59,11,54,6,"catch"],[59,16,52,3],[59,17,54,12],[59,27,54,22,"error"],[59,32,54,12],[59,34,54,29],[60,0,55,4],[60,14,55,8,"attempts"],[60,22,55,4],[60,24,55,18],[61,0,56,5],[61,14,56,7,"attempts"],[61,22,56,5],[62,0,57,5],[62,19,57,12,"setTimeout"],[62,30,57,23],[62,42,57,35],[63,0,58,6,"fetchRequest"],[64,0,59,6],[64,13,57,12],[64,15,59,8,"retryDelay"],[64,25,57,12],[64,26,57,5],[65,0,60,5],[67,0,61,4],[67,17,61,11,"reject"],[67,24,61,18,"error"],[67,29,61,11],[67,30,61,4],[68,0,62,4],[68,9,52,3],[69,0,63,3],[69,7,51,2],[71,0,64,2,"fetchRequest"],[72,0,65,2],[72,5,50,8],[72,6,50,1],[73,0,66,1],[73,3,45,0],[75,0,68,0],[75,6,68,4,"sendPostToAPI"],[75,22,68,20,"exports"],[75,30,68,28,"sendPostToAPI"],[75,43,68,20],[75,46,68,44],[75,55,68,53,"sendPostToAPI"],[75,68,68,44],[75,69,68,67,"methodName"],[75,79,68,44],[75,81,68,79,"_ref"],[75,85,68,44],[75,87,68,85,"options"],[75,94,68,44],[75,96,68,94],[76,0,69,1],[76,8,69,5,"environment"],[76,22,69,19,"_ref"],[76,27,69,24,"environment"],[76,38,69,1],[77,0,69,1],[77,8,70,5,"license"],[77,18,70,15,"_ref"],[77,23,70,20,"license"],[77,30,69,1],[78,0,69,1],[78,8,71,5,"body"],[78,15,71,12,"_ref"],[78,20,71,17,"body"],[78,24,69,1],[79,0,73,1],[79,8,73,5,"requestUrl"],[79,21,73,18,"getAPIUrl"],[79,31,73,28,"environment"],[79,42,73,18],[79,44,73,41,"license"],[79,51,73,18],[79,55,73,52],[79,58,73,18],[79,61,73,58,"methodName"],[79,71,73,1],[80,0,74,1],[80,11,74,8,"fetchWithRetry"],[80,26,74,23,"requestUrl"],[80,36,74,8],[80,38,74,35],[81,0,75,2,"method"],[81,14,75,10],[81,20,74,35],[82,0,76,2,"headers"],[82,15,76,11],[83,0,77,3],[83,24,77,19],[84,0,76,11],[84,7,74,35],[85,0,79,2,"credentials"],[85,19,79,15],[85,28,74,35],[86,0,80,2,"body"],[86,12,80,8,"JSON"],[86,17,80,13,"stringify"],[86,26,80,8],[86,27,80,23,"body"],[86,31,80,8],[87,0,74,35],[87,5,74,8],[87,7,81,4,"options"],[87,14,74,8],[87,16,81,13,"then"],[87,20,74,8],[87,21,81,18],[87,31,81,28,"response"],[87,39,81,18],[87,41,81,38],[88,0,82,2],[88,13,82,9,"response"],[88,22,82,18,"json"],[88,26,82,9],[88,28,82,2],[89,0,83,2],[89,5,74,8],[89,6,74,1],[90,0,84,1],[90,3,68,0],[92,0,86,0],[92,6,86,4,"sendPostToWebserv"],[92,26,86,24,"exports"],[92,34,86,32,"sendPostToWebserv"],[92,51,86,24],[92,54,86,52],[92,63,86,61,"sendPostToWebserv"],[92,80,86,52],[92,81,86,79,"methodName"],[92,91,86,52],[92,93,86,91,"_ref2"],[92,98,86,52],[92,100,86,98,"options"],[92,107,86,52],[92,109,86,107],[93,0,87,1],[93,8,87,5,"environment"],[93,22,87,19,"_ref2"],[93,28,87,25,"environment"],[93,39,87,1],[94,0,87,1],[94,8,88,5,"license"],[94,18,88,15,"_ref2"],[94,24,88,21,"license"],[94,31,87,1],[95,0,87,1],[95,8,89,5,"body"],[95,15,89,12,"_ref2"],[95,21,89,18,"body"],[95,25,87,1],[96,0,87,1],[96,8,90,5,"securedToken"],[96,23,90,20,"_ref2"],[96,29,90,26,"securedToken"],[96,41,87,1],[97,0,87,1],[97,8,91,5,"secretId"],[97,19,91,16,"_ref2"],[97,25,91,22,"secretId"],[97,33,87,1],[98,0,93,1],[98,8,93,5,"webservPart"],[98,22,93,19,"methodName"],[98,37,93,34],[98,50,93,19],[98,54,93,51,"methodName"],[98,65,93,62,"indexOf"],[98,72,93,51],[98,73,93,70],[98,92,93,51],[98,98,93,95],[98,99,93,96],[98,100,93,19],[98,103,93,100],[98,108,93,19],[98,111,93,108],[98,113,93,1],[99,0,94,1],[99,8,94,5,"requestUrl"],[99,21,94,18,"getServerUrl"],[99,34,94,31,"environment"],[99,45,94,18],[99,47,94,44,"license"],[99,54,94,18],[99,58,94,55],[99,78,94,18],[99,81,94,78,"license"],[99,88,94,18],[99,91,94,88],[99,94,94,18],[99,97,94,94,"webservPart"],[99,108,94,18],[99,111,94,108,"methodName"],[99,121,94,1],[101,0,95,1],[101,8,95,5,"securedToken"],[101,20,95,1],[101,22,95,19],[102,0,96,2,"requestUrl"],[102,20,96,16],[102,39,96,35,"securedToken"],[102,51,96,2],[103,0,97,2],[105,0,98,1],[105,8,98,5,"secretId"],[105,16,98,1],[105,18,98,15],[106,0,99,2,"requestUrl"],[106,20,99,16],[106,36,99,32,"secretId"],[106,44,99,2],[107,0,100,2],[109,0,101,1],[109,11,101,8,"fetchWithRetry"],[109,26,101,23,"requestUrl"],[109,36,101,8],[109,38,101,35],[110,0,102,2,"method"],[110,14,102,10],[110,20,101,35],[111,0,103,2,"headers"],[111,15,103,11],[112,0,104,3],[112,24,104,19],[113,0,103,11],[113,7,101,35],[114,0,106,2,"credentials"],[114,19,106,15],[114,28,101,35],[115,0,107,2,"body"],[115,12,107,8,"JSON"],[115,17,107,13,"stringify"],[115,26,107,8],[115,27,107,23,"body"],[115,31,107,8],[116,0,101,35],[116,5,101,8],[116,7,108,4,"options"],[116,14,101,8],[116,16,108,13,"then"],[116,20,101,8],[116,21,108,18],[116,31,108,28,"response"],[116,39,108,18],[116,41,108,38],[117,0,109,2],[117,13,109,9,"response"],[117,22,109,18,"json"],[117,26,109,9],[117,28,109,2],[118,0,110,2],[118,5,101,8],[118,6,101,1],[119,0,111,1],[119,3,86,0],[121,0,113,0],[121,6,113,4,"sendIWCS"],[121,17,113,15,"exports"],[121,25,113,23,"sendIWCS"],[121,33,113,15],[121,36,113,34],[121,45,113,43,"sendIWCS"],[121,53,113,34],[121,54,113,52,"environment"],[121,65,113,34],[121,67,113,65,"licenseNumber"],[121,80,113,34],[121,82,113,80,"command"],[121,89,113,34],[121,91,113,89,"securedToken"],[121,103,113,34],[121,105,113,103,"secretId"],[121,113,113,34],[121,115,113,113],[122,0,114,1],[122,8,114,5,"requestUrl"],[122,21,114,18,"getServerUrl"],[122,34,114,31,"environment"],[122,45,114,18],[122,47,114,44,"licenseNumber"],[122,60,114,18],[122,64,114,61],[122,84,114,18],[122,87,114,84,"licenseNumber"],[122,100,114,18],[122,103,114,100],[122,126,114,18],[122,129,114,126,"generateRandomId"],[122,146,114,143],[122,148,114,126],[122,149,114,1],[124,0,115,1],[124,8,115,5,"securedToken"],[124,20,115,1],[124,22,115,19],[125,0,116,2,"requestUrl"],[125,20,116,16],[125,39,116,35,"securedToken"],[125,51,116,2],[126,0,117,2],[128,0,118,1],[128,8,118,5,"secretId"],[128,16,118,1],[128,18,118,15],[129,0,119,2,"requestUrl"],[129,20,119,16],[129,36,119,32,"secretId"],[129,44,119,2],[130,0,120,2],[132,0,121,1,"requestUrl"],[132,18,121,15],[132,32,121,29,"encodeURI"],[132,42,121,39,"command"],[132,49,121,29],[132,50,121,1],[133,0,122,1],[133,11,122,8,"fetchWithRetry"],[133,26,122,23,"requestUrl"],[133,36,122,8],[133,38,122,35],[134,0,123,2,"method"],[134,14,123,10],[134,19,122,35],[135,0,124,2,"headers"],[135,15,124,11],[136,0,125,3],[136,24,125,19],[137,0,124,11],[137,7,122,35],[138,0,127,2,"credentials"],[138,19,127,15],[139,0,122,35],[139,5,122,8],[139,7,128,4,"then"],[139,11,122,8],[139,12,128,9],[139,22,128,19,"response"],[139,30,128,9],[139,32,128,29],[140,0,129,2],[140,13,129,9,"response"],[140,22,129,18,"text"],[140,26,129,9],[140,28,129,2],[141,0,130,2],[141,5,122,8],[141,7,130,4,"then"],[141,11,122,8],[141,12,130,9],[141,22,130,19,"responseText"],[141,34,130,9],[141,36,130,33],[142,0,131,2],[142,13,131,9,"responseText"],[142,26,131,22,"split"],[142,31,131,9],[142,32,131,28],[142,35,131,9],[142,36,131,2],[143,0,132,2],[143,5,122,8],[143,6,122,1],[144,0,133,1],[144,3,113,0]]},"type":"js/module"}]}