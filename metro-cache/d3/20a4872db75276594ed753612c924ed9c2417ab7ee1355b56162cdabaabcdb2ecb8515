{"dependencies":[{"name":"@livechat/saga-utils","isAsync":false},{"name":"redux-saga/effects","isAsync":false},{"name":"../../utils/serverRequest","isAsync":false},{"name":"../../reducers","isAsync":false}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, module, exports, _dependencyMap) {\n  'use strict';\n\n  exports.__esModule = true;\n\n  var _sagaUtils = _$$_REQUIRE(_dependencyMap[0], '@livechat/saga-utils');\n\n  var _effects = _$$_REQUIRE(_dependencyMap[1], 'redux-saga/effects');\n\n  var _serverRequest = _$$_REQUIRE(_dependencyMap[2], '../../utils/serverRequest');\n\n  var _reducers = _$$_REQUIRE(_dependencyMap[3], '../../reducers');\n\n  var _marked = regeneratorRuntime.mark(sendMessage);\n\n  function sendMessage(_ref) {\n    var customId = _ref.customId,\n        text = _ref.text;\n    var license, visitorId, securedToken, secretId, environment, sendMessageData, sendMessageResponse;\n    return regeneratorRuntime.wrap(function sendMessage$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return (0, _effects.select)(_reducers.propsSelectors.getPropertyLicense);\n\n          case 2:\n            license = _context.sent;\n            _context.next = 5;\n            return (0, _effects.call)(_sagaUtils.waitForState, _reducers.propsSelectors.getPropertyVisitorId);\n\n          case 5:\n            visitorId = _context.sent;\n            _context.next = 8;\n            return (0, _effects.select)(_reducers.propsSelectors.getPropertySecuredToken);\n\n          case 8:\n            securedToken = _context.sent;\n            _context.next = 11;\n            return (0, _effects.select)(_reducers.propsSelectors.getPropertySecretId);\n\n          case 11:\n            secretId = _context.sent;\n            _context.next = 14;\n            return (0, _effects.select)(_reducers.getEnvironment);\n\n          case 14:\n            environment = _context.sent;\n            sendMessageData = {\n              environment: environment,\n              license: license,\n              securedToken: securedToken,\n              secretId: secretId,\n              body: {\n                author: 'visitor',\n                message: text,\n                message_id: customId,\n                random_id: customId,\n                visitor: {\n                  id: visitorId\n                }\n              }\n            };\n            _context.next = 18;\n            return (0, _effects.call)(_serverRequest.sendPostToWebserv, 'send_message', sendMessageData);\n\n          case 18:\n            sendMessageResponse = _context.sent;\n\n          case 19:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _marked, this);\n  }\n\n  exports.default = sendMessage;\n});","map":[[2,0,1,0],[4,0,3,0,"exports"],[4,10,3,8,"__esModule"],[4,20,3,0],[4,23,3,21],[4,27,3,0],[6,0,5,0],[6,6,5,4,"_sagaUtils"],[6,19,5,17,"require"],[6,50,5,25],[6,72,5,17],[6,73,5,0],[8,0,7,0],[8,6,7,4,"_effects"],[8,17,7,15,"require"],[8,48,7,23],[8,68,7,15],[8,69,7,0],[10,0,9,0],[10,6,9,4,"_serverRequest"],[10,23,9,21,"require"],[10,54,9,29],[10,81,9,21],[10,82,9,0],[12,0,11,0],[12,6,11,4,"_reducers"],[12,18,11,16,"require"],[12,49,11,24],[12,65,11,16],[12,66,11,0],[14,0,13,0],[14,6,13,4,"_marked"],[14,16,13,27,"regeneratorRuntime"],[14,35,13,46,"mark"],[14,39,13,27],[14,40,13,51,"sendMessage"],[14,51,13,27],[14,52,13,0],[16,0,15,0],[16,11,15,9,"sendMessage"],[16,22,15,0],[16,23,15,21,"_ref"],[16,27,15,0],[16,29,15,27],[17,0,16,1],[17,8,16,5,"customId"],[17,19,16,16,"_ref"],[17,24,16,21,"customId"],[17,32,16,1],[18,0,16,1],[18,8,17,5,"text"],[18,15,17,12,"_ref"],[18,20,17,17,"text"],[18,24,16,1],[19,0,18,1],[19,8,18,5,"license"],[19,15,18,1],[19,17,18,14,"visitorId"],[19,26,18,1],[19,28,18,25,"securedToken"],[19,40,18,1],[19,42,18,39,"secretId"],[19,50,18,1],[19,52,18,49,"environment"],[19,63,18,1],[19,65,18,62,"sendMessageData"],[19,80,18,1],[19,82,18,79,"sendMessageResponse"],[19,101,18,1],[20,0,19,1],[20,11,19,8,"regeneratorRuntime"],[20,30,19,27,"wrap"],[20,34,19,8],[20,35,19,32],[20,44,19,41,"sendMessage$"],[20,56,19,32],[20,57,19,54,"_context"],[20,65,19,32],[20,67,19,64],[21,0,20,2],[21,13,20,9],[21,14,20,2],[21,16,20,12],[22,0,21,3],[22,16,21,11,"_context"],[22,25,21,20,"prev"],[22,29,21,11],[22,32,21,27,"_context"],[22,41,21,36,"next"],[22,45,21,3],[23,0,22,4],[23,15,22,9],[23,16,22,4],[24,0,23,5,"_context"],[24,21,23,14,"next"],[24,25,23,5],[24,28,23,21],[24,29,23,5],[25,0,24,5],[25,19,24,12],[25,20,24,13],[25,23,24,16,"_effects"],[25,32,24,25,"select"],[25,38,24,12],[25,40,24,33,"_reducers"],[25,50,24,43,"propsSelectors"],[25,64,24,33],[25,65,24,58,"getPropertyLicense"],[25,83,24,12],[25,84,24,5],[27,0,26,4],[27,15,26,9],[27,16,26,4],[28,0,27,5,"license"],[28,22,27,15,"_context"],[28,31,27,24,"sent"],[28,35,27,5],[29,0,28,5,"_context"],[29,21,28,14,"next"],[29,25,28,5],[29,28,28,21],[29,29,28,5],[30,0,29,5],[30,19,29,12],[30,20,29,13],[30,23,29,16,"_effects"],[30,32,29,25,"call"],[30,36,29,12],[30,38,29,31,"_sagaUtils"],[30,49,29,42,"waitForState"],[30,61,29,12],[30,63,29,56,"_reducers"],[30,73,29,66,"propsSelectors"],[30,87,29,56],[30,88,29,81,"getPropertyVisitorId"],[30,108,29,12],[30,109,29,5],[32,0,31,4],[32,15,31,9],[32,16,31,4],[33,0,32,5,"visitorId"],[33,24,32,17,"_context"],[33,33,32,26,"sent"],[33,37,32,5],[34,0,33,5,"_context"],[34,21,33,14,"next"],[34,25,33,5],[34,28,33,21],[34,29,33,5],[35,0,34,5],[35,19,34,12],[35,20,34,13],[35,23,34,16,"_effects"],[35,32,34,25,"select"],[35,38,34,12],[35,40,34,33,"_reducers"],[35,50,34,43,"propsSelectors"],[35,64,34,33],[35,65,34,58,"getPropertySecuredToken"],[35,88,34,12],[35,89,34,5],[37,0,36,4],[37,15,36,9],[37,16,36,4],[38,0,37,5,"securedToken"],[38,27,37,20,"_context"],[38,36,37,29,"sent"],[38,40,37,5],[39,0,38,5,"_context"],[39,21,38,14,"next"],[39,25,38,5],[39,28,38,21],[39,30,38,5],[40,0,39,5],[40,19,39,12],[40,20,39,13],[40,23,39,16,"_effects"],[40,32,39,25,"select"],[40,38,39,12],[40,40,39,33,"_reducers"],[40,50,39,43,"propsSelectors"],[40,64,39,33],[40,65,39,58,"getPropertySecretId"],[40,84,39,12],[40,85,39,5],[42,0,41,4],[42,15,41,9],[42,17,41,4],[43,0,42,5,"secretId"],[43,23,42,16,"_context"],[43,32,42,25,"sent"],[43,36,42,5],[44,0,43,5,"_context"],[44,21,43,14,"next"],[44,25,43,5],[44,28,43,21],[44,30,43,5],[45,0,44,5],[45,19,44,12],[45,20,44,13],[45,23,44,16,"_effects"],[45,32,44,25,"select"],[45,38,44,12],[45,40,44,33,"_reducers"],[45,50,44,43,"getEnvironment"],[45,64,44,12],[45,65,44,5],[47,0,46,4],[47,15,46,9],[47,17,46,4],[48,0,47,5,"environment"],[48,26,47,19,"_context"],[48,35,47,28,"sent"],[48,39,47,5],[49,0,48,5,"sendMessageData"],[49,30,48,23],[50,0,49,6,"environment"],[50,27,49,19,"environment"],[50,38,48,23],[51,0,50,6,"license"],[51,23,50,15,"license"],[51,30,48,23],[52,0,51,6,"securedToken"],[52,28,51,20,"securedToken"],[52,40,48,23],[53,0,52,6,"secretId"],[53,24,52,16,"secretId"],[53,32,48,23],[54,0,53,6,"body"],[54,20,53,12],[55,0,54,7,"author"],[55,24,54,15],[55,33,53,12],[56,0,55,7,"message"],[56,25,55,16,"text"],[56,29,53,12],[57,0,56,7,"message_id"],[57,28,56,19,"customId"],[57,36,53,12],[58,0,57,7,"random_id"],[58,27,57,18,"customId"],[58,35,53,12],[59,0,58,7,"visitor"],[59,25,58,16],[60,0,59,8,"id"],[60,22,59,12,"visitorId"],[61,0,58,16],[62,0,53,12],[63,0,48,23],[63,13,48,5],[64,0,63,5,"_context"],[64,21,63,14,"next"],[64,25,63,5],[64,28,63,21],[64,30,63,5],[65,0,64,5],[65,19,64,12],[65,20,64,13],[65,23,64,16,"_effects"],[65,32,64,25,"call"],[65,36,64,12],[65,38,64,31,"_serverRequest"],[65,53,64,46,"sendPostToWebserv"],[65,70,64,12],[65,72,64,65],[65,86,64,12],[65,88,64,81,"sendMessageData"],[65,103,64,12],[65,104,64,5],[67,0,66,4],[67,15,66,9],[67,17,66,4],[68,0,67,5,"sendMessageResponse"],[68,34,67,27,"_context"],[68,43,67,36,"sent"],[68,47,67,5],[70,0,69,4],[70,15,69,9],[70,17,69,4],[71,0,70,4],[71,15,70,9],[71,20,70,4],[72,0,71,5],[72,19,71,12,"_context"],[72,28,71,21,"stop"],[72,32,71,12],[72,34,71,5],[73,0,21,3],[74,0,73,3],[75,0,74,2],[75,5,19,8],[75,7,74,4,"_marked"],[75,14,19,8],[75,16,74,13],[75,20,19,8],[75,21,19,1],[76,0,75,1],[78,0,77,0,"exports"],[78,10,77,8,"default"],[78,17,77,0],[78,20,77,18,"sendMessage"],[78,31,77,0]]},"type":"js/module"}]}