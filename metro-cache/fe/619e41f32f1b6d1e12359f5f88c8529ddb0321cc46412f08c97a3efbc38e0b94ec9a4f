{"dependencies":[{"name":"redux-saga/effects","isAsync":false},{"name":"@livechat/saga-utils","isAsync":false},{"name":"../../actions/propsActions","isAsync":false},{"name":"../../utils/serverRequest","isAsync":false},{"name":"../../reducers","isAsync":false},{"name":"../../utils/storage","isAsync":false},{"name":"../../constants/chatStates","isAsync":false}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, module, exports, _dependencyMap) {\n  'use strict';\n\n  exports.__esModule = true;\n\n  var _effects = _$$_REQUIRE(_dependencyMap[0], 'redux-saga/effects');\n\n  var _sagaUtils = _$$_REQUIRE(_dependencyMap[1], '@livechat/saga-utils');\n\n  var _propsActions = _$$_REQUIRE(_dependencyMap[2], '../../actions/propsActions');\n\n  var _propsActions2 = _interopRequireDefault(_propsActions);\n\n  var _serverRequest = _$$_REQUIRE(_dependencyMap[3], '../../utils/serverRequest');\n\n  var _reducers = _$$_REQUIRE(_dependencyMap[4], '../../reducers');\n\n  var _storage = _$$_REQUIRE(_dependencyMap[5], '../../utils/storage');\n\n  var _storage2 = _interopRequireDefault(_storage);\n\n  var _chatStates = _$$_REQUIRE(_dependencyMap[6], '../../constants/chatStates');\n\n  var chatStates = _interopRequireWildcard(_chatStates);\n\n  function _interopRequireWildcard(obj) {\n    if (obj && obj.__esModule) {\n      return obj;\n    } else {\n      var newObj = {};\n\n      if (obj != null) {\n        for (var key in obj) {\n          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n        }\n      }\n\n      newObj.default = obj;\n      return newObj;\n    }\n  }\n\n  function _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : {\n      default: obj\n    };\n  }\n\n  var _marked = regeneratorRuntime.mark(startChat);\n\n  function startChat(_ref) {\n    var customId = _ref.customId,\n        text = _ref.text;\n    var license, group, visitorId, visitorData, environment, startChatBody, startChatData, startChatResponse;\n    return regeneratorRuntime.wrap(function startChat$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return (0, _effects.select)(_reducers.propsSelectors.getPropertyLicense);\n\n          case 2:\n            license = _context.sent;\n            _context.next = 5;\n            return (0, _effects.select)(_reducers.propsSelectors.getPropertyGroup);\n\n          case 5:\n            group = _context.sent;\n            _context.next = 8;\n            return (0, _effects.call)(_sagaUtils.waitForState, _reducers.propsSelectors.getPropertyVisitorId);\n\n          case 8:\n            visitorId = _context.sent;\n            _context.next = 11;\n            return (0, _effects.select)(_reducers.getVisitorData);\n\n          case 11:\n            visitorData = _context.sent;\n            _context.next = 14;\n            return (0, _effects.select)(_reducers.getEnvironment);\n\n          case 14:\n            environment = _context.sent;\n            startChatBody = {\n              group: group,\n              source_group: group,\n              details: '',\n              details_labels: '',\n              from_manual_invitation: false,\n              integration_params: '',\n              random_id: customId,\n              trigger_unique_id: '',\n              version: 'Embedded',\n              custom_variables: {},\n              welcome_message: '',\n              is_mobile: false,\n              return_secured_session_id: true,\n              visitor: {\n                id: visitorId,\n                nick: visitorData.name || 'Client',\n                email: visitorData.email || ''\n              }\n            };\n\n            if (text) {\n              startChatBody.visitor_message = text;\n              startChatBody.visitor_message_id = customId;\n            }\n\n            if (visitorData.customProperties) {\n              startChatBody.custom_variables = visitorData.customProperties;\n            }\n\n            startChatData = {\n              license: license,\n              environment: environment,\n              body: startChatBody\n            };\n            _context.next = 21;\n            return (0, _effects.call)(_serverRequest.sendPostToWebserv, 'start_chat', startChatData);\n\n          case 21:\n            startChatResponse = _context.sent;\n\n            if (!startChatResponse.secured_session_id) {\n              _context.next = 26;\n              break;\n            }\n\n            _context.next = 25;\n            return (0, _effects.put)(_propsActions2.default.setPropertySecretId(startChatResponse.secured_session_id));\n\n          case 25:\n            _storage2.default.setItem('secretId', startChatResponse.secured_session_id);\n\n          case 26:\n            if (!startChatResponse.secured_token) {\n              _context.next = 32;\n              break;\n            }\n\n            _context.next = 29;\n            return (0, _effects.put)(_propsActions2.default.setPropertySecuredToken(startChatResponse.secured_token));\n\n          case 29:\n            _context.next = 31;\n            return (0, _effects.put)(_propsActions2.default.setPropertyChatState(chatStates.CHATTING));\n\n          case 31:\n            _storage2.default.setItem('securedToken', startChatResponse.secured_token);\n\n          case 32:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _marked, this);\n  }\n\n  exports.default = startChat;\n});","map":[[2,0,1,0],[4,0,3,0,"exports"],[4,10,3,8,"__esModule"],[4,20,3,0],[4,23,3,21],[4,27,3,0],[6,0,5,0],[6,6,5,4,"_effects"],[6,17,5,15,"require"],[6,48,5,23],[6,68,5,15],[6,69,5,0],[8,0,7,0],[8,6,7,4,"_sagaUtils"],[8,19,7,17,"require"],[8,50,7,25],[8,72,7,17],[8,73,7,0],[10,0,9,0],[10,6,9,4,"_propsActions"],[10,22,9,20,"require"],[10,53,9,28],[10,81,9,20],[10,82,9,0],[12,0,11,0],[12,6,11,4,"_propsActions2"],[12,23,11,21,"_interopRequireDefault"],[12,46,11,44,"_propsActions"],[12,59,11,21],[12,60,11,0],[14,0,13,0],[14,6,13,4,"_serverRequest"],[14,23,13,21,"require"],[14,54,13,29],[14,81,13,21],[14,82,13,0],[16,0,15,0],[16,6,15,4,"_reducers"],[16,18,15,16,"require"],[16,49,15,24],[16,65,15,16],[16,66,15,0],[18,0,17,0],[18,6,17,4,"_storage"],[18,17,17,15,"require"],[18,48,17,23],[18,69,17,15],[18,70,17,0],[20,0,19,0],[20,6,19,4,"_storage2"],[20,18,19,16,"_interopRequireDefault"],[20,41,19,39,"_storage"],[20,49,19,16],[20,50,19,0],[22,0,21,0],[22,6,21,4,"_chatStates"],[22,20,21,18,"require"],[22,51,21,26],[22,79,21,18],[22,80,21,0],[24,0,23,0],[24,6,23,4,"chatStates"],[24,19,23,17,"_interopRequireWildcard"],[24,43,23,41,"_chatStates"],[24,54,23,17],[24,55,23,0],[26,0,25,0],[26,11,25,9,"_interopRequireWildcard"],[26,34,25,0],[26,35,25,33,"obj"],[26,38,25,0],[26,40,25,38],[27,0,25,40],[27,8,25,44,"obj"],[27,15,25,51,"obj"],[27,19,25,55,"__esModule"],[27,29,25,40],[27,31,25,67],[28,0,25,69],[28,13,25,76,"obj"],[28,16,25,69],[29,0,25,82],[29,5,25,40],[29,11,25,88],[30,0,25,90],[30,10,25,94,"newObj"],[30,19,25,103],[30,21,25,90],[32,0,25,107],[32,10,25,111,"obj"],[32,17,25,118],[32,21,25,107],[32,23,25,124],[33,0,25,126],[33,13,25,131],[33,17,25,135,"key"],[33,20,25,126],[33,24,25,142,"obj"],[33,27,25,126],[33,29,25,147],[34,0,25,149],[34,14,25,153,"Object"],[34,21,25,160,"prototype"],[34,30,25,153],[34,31,25,170,"hasOwnProperty"],[34,45,25,153],[34,46,25,185,"call"],[34,50,25,153],[34,51,25,190,"obj"],[34,54,25,153],[34,56,25,195,"key"],[34,59,25,153],[34,60,25,149],[34,62,25,201,"newObj"],[34,69,25,208,"key"],[34,72,25,201],[34,76,25,215,"obj"],[34,80,25,219,"key"],[34,83,25,215],[34,84,25,201],[35,0,25,226],[36,0,25,228],[38,0,25,229,"newObj"],[38,13,25,236,"default"],[38,20,25,229],[38,23,25,246,"obj"],[38,26,25,229],[39,0,25,251],[39,13,25,258,"newObj"],[39,19,25,251],[40,0,25,267],[41,0,25,269],[43,0,27,0],[43,11,27,9,"_interopRequireDefault"],[43,33,27,0],[43,34,27,32,"obj"],[43,37,27,0],[43,39,27,37],[44,0,27,39],[44,11,27,46,"obj"],[44,18,27,53,"obj"],[44,22,27,57,"__esModule"],[44,32,27,46],[44,35,27,70,"obj"],[44,38,27,46],[44,41,27,76],[45,0,27,78,"default"],[45,15,27,87,"obj"],[46,0,27,76],[46,5,27,39],[47,0,27,95],[49,0,29,0],[49,6,29,4,"_marked"],[49,16,29,27,"regeneratorRuntime"],[49,35,29,46,"mark"],[49,39,29,27],[49,40,29,51,"startChat"],[49,49,29,27],[49,50,29,0],[51,0,31,0],[51,11,31,9,"startChat"],[51,20,31,0],[51,21,31,19,"_ref"],[51,25,31,0],[51,27,31,25],[52,0,32,1],[52,8,32,5,"customId"],[52,19,32,16,"_ref"],[52,24,32,21,"customId"],[52,32,32,1],[53,0,32,1],[53,8,33,5,"text"],[53,15,33,12,"_ref"],[53,20,33,17,"text"],[53,24,32,1],[54,0,34,1],[54,8,34,5,"license"],[54,15,34,1],[54,17,34,14,"group"],[54,22,34,1],[54,24,34,21,"visitorId"],[54,33,34,1],[54,35,34,32,"visitorData"],[54,46,34,1],[54,48,34,45,"environment"],[54,59,34,1],[54,61,34,58,"startChatBody"],[54,74,34,1],[54,76,34,73,"startChatData"],[54,89,34,1],[54,91,34,88,"startChatResponse"],[54,108,34,1],[55,0,35,1],[55,11,35,8,"regeneratorRuntime"],[55,30,35,27,"wrap"],[55,34,35,8],[55,35,35,32],[55,44,35,41,"startChat$"],[55,54,35,32],[55,55,35,52,"_context"],[55,63,35,32],[55,65,35,62],[56,0,36,2],[56,13,36,9],[56,14,36,2],[56,16,36,12],[57,0,37,3],[57,16,37,11,"_context"],[57,25,37,20,"prev"],[57,29,37,11],[57,32,37,27,"_context"],[57,41,37,36,"next"],[57,45,37,3],[58,0,38,4],[58,15,38,9],[58,16,38,4],[59,0,39,5,"_context"],[59,21,39,14,"next"],[59,25,39,5],[59,28,39,21],[59,29,39,5],[60,0,40,5],[60,19,40,12],[60,20,40,13],[60,23,40,16,"_effects"],[60,32,40,25,"select"],[60,38,40,12],[60,40,40,33,"_reducers"],[60,50,40,43,"propsSelectors"],[60,64,40,33],[60,65,40,58,"getPropertyLicense"],[60,83,40,12],[60,84,40,5],[62,0,42,4],[62,15,42,9],[62,16,42,4],[63,0,43,5,"license"],[63,22,43,15,"_context"],[63,31,43,24,"sent"],[63,35,43,5],[64,0,44,5,"_context"],[64,21,44,14,"next"],[64,25,44,5],[64,28,44,21],[64,29,44,5],[65,0,45,5],[65,19,45,12],[65,20,45,13],[65,23,45,16,"_effects"],[65,32,45,25,"select"],[65,38,45,12],[65,40,45,33,"_reducers"],[65,50,45,43,"propsSelectors"],[65,64,45,33],[65,65,45,58,"getPropertyGroup"],[65,81,45,12],[65,82,45,5],[67,0,47,4],[67,15,47,9],[67,16,47,4],[68,0,48,5,"group"],[68,20,48,13,"_context"],[68,29,48,22,"sent"],[68,33,48,5],[69,0,49,5,"_context"],[69,21,49,14,"next"],[69,25,49,5],[69,28,49,21],[69,29,49,5],[70,0,50,5],[70,19,50,12],[70,20,50,13],[70,23,50,16,"_effects"],[70,32,50,25,"call"],[70,36,50,12],[70,38,50,31,"_sagaUtils"],[70,49,50,42,"waitForState"],[70,61,50,12],[70,63,50,56,"_reducers"],[70,73,50,66,"propsSelectors"],[70,87,50,56],[70,88,50,81,"getPropertyVisitorId"],[70,108,50,12],[70,109,50,5],[72,0,52,4],[72,15,52,9],[72,16,52,4],[73,0,53,5,"visitorId"],[73,24,53,17,"_context"],[73,33,53,26,"sent"],[73,37,53,5],[74,0,54,5,"_context"],[74,21,54,14,"next"],[74,25,54,5],[74,28,54,21],[74,30,54,5],[75,0,55,5],[75,19,55,12],[75,20,55,13],[75,23,55,16,"_effects"],[75,32,55,25,"select"],[75,38,55,12],[75,40,55,33,"_reducers"],[75,50,55,43,"getVisitorData"],[75,64,55,12],[75,65,55,5],[77,0,57,4],[77,15,57,9],[77,17,57,4],[78,0,58,5,"visitorData"],[78,26,58,19,"_context"],[78,35,58,28,"sent"],[78,39,58,5],[79,0,59,5,"_context"],[79,21,59,14,"next"],[79,25,59,5],[79,28,59,21],[79,30,59,5],[80,0,60,5],[80,19,60,12],[80,20,60,13],[80,23,60,16,"_effects"],[80,32,60,25,"select"],[80,38,60,12],[80,40,60,33,"_reducers"],[80,50,60,43,"getEnvironment"],[80,64,60,12],[80,65,60,5],[82,0,62,4],[82,15,62,9],[82,17,62,4],[83,0,63,5,"environment"],[83,26,63,19,"_context"],[83,35,63,28,"sent"],[83,39,63,5],[84,0,64,5,"startChatBody"],[84,28,64,21],[85,0,65,6,"group"],[85,21,65,13,"group"],[85,26,64,21],[86,0,66,6,"source_group"],[86,28,66,20,"group"],[86,33,64,21],[87,0,67,6,"details"],[87,23,67,15],[87,25,64,21],[88,0,68,6,"details_labels"],[88,30,68,22],[88,32,64,21],[89,0,69,6,"from_manual_invitation"],[89,38,69,30],[89,43,64,21],[90,0,70,6,"integration_params"],[90,34,70,26],[90,36,64,21],[91,0,71,6,"random_id"],[91,25,71,17,"customId"],[91,33,64,21],[92,0,72,6,"trigger_unique_id"],[92,33,72,25],[92,35,64,21],[93,0,73,6,"version"],[93,23,73,15],[93,33,64,21],[94,0,74,6,"custom_variables"],[94,32,74,24],[94,34,64,21],[95,0,75,6,"welcome_message"],[95,31,75,23],[95,33,64,21],[96,0,76,6,"is_mobile"],[96,25,76,17],[96,30,64,21],[97,0,77,6,"return_secured_session_id"],[97,41,77,33],[97,45,64,21],[98,0,78,6,"visitor"],[98,23,78,15],[99,0,79,7,"id"],[99,20,79,11,"visitorId"],[99,29,78,15],[100,0,80,7,"nick"],[100,22,80,13,"visitorData"],[100,34,80,25,"name"],[100,38,80,13],[100,42,80,33],[100,50,78,15],[101,0,81,7,"email"],[101,23,81,14,"visitorData"],[101,35,81,26,"email"],[101,40,81,14],[101,44,81,35],[102,0,78,15],[103,0,64,21],[103,13,64,5],[105,0,85,5],[105,16,85,9,"text"],[105,20,85,5],[105,22,85,15],[106,0,86,6,"startChatBody"],[106,28,86,20,"visitor_message"],[106,43,86,6],[106,46,86,38,"text"],[106,50,86,6],[107,0,87,6,"startChatBody"],[107,28,87,20,"visitor_message_id"],[107,46,87,6],[107,49,87,41,"customId"],[107,57,87,6],[108,0,88,6],[110,0,89,5],[110,16,89,9,"visitorData"],[110,28,89,21,"customProperties"],[110,44,89,5],[110,46,89,39],[111,0,90,6,"startChatBody"],[111,28,90,20,"custom_variables"],[111,44,90,6],[111,47,90,39,"visitorData"],[111,59,90,51,"customProperties"],[111,75,90,6],[112,0,91,6],[114,0,92,5,"startChatData"],[114,28,92,21],[115,0,93,6,"license"],[115,23,93,15,"license"],[115,30,92,21],[116,0,94,6,"environment"],[116,27,94,19,"environment"],[116,38,92,21],[117,0,95,6,"body"],[117,20,95,12,"startChatBody"],[118,0,92,21],[118,13,92,5],[119,0,97,5,"_context"],[119,21,97,14,"next"],[119,25,97,5],[119,28,97,21],[119,30,97,5],[120,0,98,5],[120,19,98,12],[120,20,98,13],[120,23,98,16,"_effects"],[120,32,98,25,"call"],[120,36,98,12],[120,38,98,31,"_serverRequest"],[120,53,98,46,"sendPostToWebserv"],[120,70,98,12],[120,72,98,65],[120,84,98,12],[120,86,98,79,"startChatData"],[120,99,98,12],[120,100,98,5],[122,0,100,4],[122,15,100,9],[122,17,100,4],[123,0,101,5,"startChatResponse"],[123,32,101,25,"_context"],[123,41,101,34,"sent"],[123,45,101,5],[125,0,103,5],[125,16,103,9],[125,17,103,10,"startChatResponse"],[125,35,103,28,"secured_session_id"],[125,53,103,5],[125,55,103,48],[126,0,104,6,"_context"],[126,23,104,15,"next"],[126,27,104,6],[126,30,104,22],[126,32,104,6],[127,0,105,6],[128,0,106,6],[130,0,108,5,"_context"],[130,21,108,14,"next"],[130,25,108,5],[130,28,108,21],[130,30,108,5],[131,0,109,5],[131,19,109,12],[131,20,109,13],[131,23,109,16,"_effects"],[131,32,109,25,"put"],[131,35,109,12],[131,37,109,30,"_propsActions2"],[131,52,109,45,"default"],[131,59,109,30],[131,60,109,53,"setPropertySecretId"],[131,79,109,30],[131,80,109,73,"startChatResponse"],[131,98,109,91,"secured_session_id"],[131,116,109,30],[131,117,109,12],[131,118,109,5],[133,0,111,4],[133,15,111,9],[133,17,111,4],[134,0,112,5,"_storage2"],[134,22,112,15,"default"],[134,29,112,5],[134,30,112,23,"setItem"],[134,37,112,5],[134,38,112,31],[134,48,112,5],[134,50,112,43,"startChatResponse"],[134,68,112,61,"secured_session_id"],[134,86,112,5],[136,0,114,4],[136,15,114,9],[136,17,114,4],[137,0,115,5],[137,16,115,9],[137,17,115,10,"startChatResponse"],[137,35,115,28,"secured_token"],[137,48,115,5],[137,50,115,43],[138,0,116,6,"_context"],[138,23,116,15,"next"],[138,27,116,6],[138,30,116,22],[138,32,116,6],[139,0,117,6],[140,0,118,6],[142,0,120,5,"_context"],[142,21,120,14,"next"],[142,25,120,5],[142,28,120,21],[142,30,120,5],[143,0,121,5],[143,19,121,12],[143,20,121,13],[143,23,121,16,"_effects"],[143,32,121,25,"put"],[143,35,121,12],[143,37,121,30,"_propsActions2"],[143,52,121,45,"default"],[143,59,121,30],[143,60,121,53,"setPropertySecuredToken"],[143,83,121,30],[143,84,121,77,"startChatResponse"],[143,102,121,95,"secured_token"],[143,115,121,30],[143,116,121,12],[143,117,121,5],[145,0,123,4],[145,15,123,9],[145,17,123,4],[146,0,124,5,"_context"],[146,21,124,14,"next"],[146,25,124,5],[146,28,124,21],[146,30,124,5],[147,0,125,5],[147,19,125,12],[147,20,125,13],[147,23,125,16,"_effects"],[147,32,125,25,"put"],[147,35,125,12],[147,37,125,30,"_propsActions2"],[147,52,125,45,"default"],[147,59,125,30],[147,60,125,53,"setPropertyChatState"],[147,80,125,30],[147,81,125,74,"chatStates"],[147,92,125,85,"CHATTING"],[147,100,125,30],[147,101,125,12],[147,102,125,5],[149,0,127,4],[149,15,127,9],[149,17,127,4],[150,0,128,5,"_storage2"],[150,22,128,15,"default"],[150,29,128,5],[150,30,128,23,"setItem"],[150,37,128,5],[150,38,128,31],[150,52,128,5],[150,54,128,47,"startChatResponse"],[150,72,128,65,"secured_token"],[150,85,128,5],[152,0,130,4],[152,15,130,9],[152,17,130,4],[153,0,131,4],[153,15,131,9],[153,20,131,4],[154,0,132,5],[154,19,132,12,"_context"],[154,28,132,21,"stop"],[154,32,132,12],[154,34,132,5],[155,0,37,3],[156,0,134,3],[157,0,135,2],[157,5,35,8],[157,7,135,4,"_marked"],[157,14,35,8],[157,16,135,13],[157,20,35,8],[157,21,35,1],[158,0,136,1],[160,0,138,0,"exports"],[160,10,138,8,"default"],[160,17,138,0],[160,20,138,18,"startChat"],[160,29,138,0]]},"type":"js/module"}]}