{"dependencies":[{"name":"redux-saga/effects","isAsync":false},{"name":"redux-saga","isAsync":false},{"name":"@livechat/saga-utils","isAsync":false},{"name":"../reducers","isAsync":false},{"name":"../utils/serverRequest","isAsync":false},{"name":"../actions/propsActions","isAsync":false},{"name":"../constants/chatStatuses","isAsync":false}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, module, exports, _dependencyMap) {\n  'use strict';\n\n  exports.__esModule = true;\n\n  var _effects = _$$_REQUIRE(_dependencyMap[0], 'redux-saga/effects');\n\n  var _reduxSaga = _$$_REQUIRE(_dependencyMap[1], 'redux-saga');\n\n  var _sagaUtils = _$$_REQUIRE(_dependencyMap[2], '@livechat/saga-utils');\n\n  var _reducers = _$$_REQUIRE(_dependencyMap[3], '../reducers');\n\n  var _serverRequest = _$$_REQUIRE(_dependencyMap[4], '../utils/serverRequest');\n\n  var _propsActions = _$$_REQUIRE(_dependencyMap[5], '../actions/propsActions');\n\n  var _propsActions2 = _interopRequireDefault(_propsActions);\n\n  var _chatStatuses = _$$_REQUIRE(_dependencyMap[6], '../constants/chatStatuses');\n\n  var chatStatuses = _interopRequireWildcard(_chatStatuses);\n\n  function _interopRequireWildcard(obj) {\n    if (obj && obj.__esModule) {\n      return obj;\n    } else {\n      var newObj = {};\n\n      if (obj != null) {\n        for (var key in obj) {\n          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n        }\n      }\n\n      newObj.default = obj;\n      return newObj;\n    }\n  }\n\n  function _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : {\n      default: obj\n    };\n  }\n\n  var _marked = regeneratorRuntime.mark(sendPing);\n\n  var parseResponseToChatStatus = function parseResponseToChatStatus(response) {\n    return response.agent_available ? chatStatuses.ONLINE : chatStatuses.OFFLINE;\n  };\n\n  function sendPing() {\n    var license, group, visitorId, environment, requestBody, statusPingResponse, chatState, currentChatStatus, connectionStatus, _connectionStatus;\n\n    return regeneratorRuntime.wrap(function sendPing$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!true) {\n              _context.next = 45;\n              break;\n            }\n\n            _context.next = 3;\n            return (0, _effects.select)(_reducers.propsSelectors.getPropertyLicense);\n\n          case 3:\n            license = _context.sent;\n            _context.next = 6;\n            return (0, _effects.select)(_reducers.propsSelectors.getPropertyGroup);\n\n          case 6:\n            group = _context.sent;\n            _context.next = 9;\n            return (0, _effects.call)(_sagaUtils.waitForState, _reducers.propsSelectors.getPropertyVisitorId);\n\n          case 9:\n            visitorId = _context.sent;\n            _context.next = 12;\n            return (0, _effects.select)(_reducers.getEnvironment);\n\n          case 12:\n            environment = _context.sent;\n            requestBody = {\n              visitor: {\n                id: visitorId\n              },\n              skill: group,\n              random_id: String(Math.random())\n            };\n            _context.prev = 14;\n            _context.next = 17;\n            return (0, _effects.call)(_serverRequest.sendPostToWebserv, 'status_ping', {\n              license: license,\n              environment: environment,\n              body: requestBody\n            }, {\n              retry: 10\n            });\n\n          case 17:\n            statusPingResponse = _context.sent;\n            _context.next = 20;\n            return (0, _effects.select)(_reducers.propsSelectors.getPropertyChatStatus);\n\n          case 20:\n            chatState = _context.sent;\n            currentChatStatus = parseResponseToChatStatus(statusPingResponse);\n            _context.next = 24;\n            return (0, _effects.select)(_reducers.propsSelectors.getPropertyConnectionStatus);\n\n          case 24:\n            connectionStatus = _context.sent;\n\n            if (!(connectionStatus !== 'connected')) {\n              _context.next = 28;\n              break;\n            }\n\n            _context.next = 28;\n            return (0, _effects.put)(_propsActions2.default.setPropertyConnectionStatus('connected'));\n\n          case 28:\n            if (!(chatState !== currentChatStatus)) {\n              _context.next = 31;\n              break;\n            }\n\n            _context.next = 31;\n            return (0, _effects.put)(_propsActions2.default.setPropertyChatStatus(currentChatStatus));\n\n          case 31:\n            _context.next = 41;\n            break;\n\n          case 33:\n            _context.prev = 33;\n            _context.t0 = _context['catch'](14);\n            _context.next = 37;\n            return (0, _effects.select)(_reducers.propsSelectors.getPropertyConnectionStatus);\n\n          case 37:\n            _connectionStatus = _context.sent;\n\n            if (!(_connectionStatus !== 'disconnected')) {\n              _context.next = 41;\n              break;\n            }\n\n            _context.next = 41;\n            return (0, _effects.put)(_propsActions2.default.setPropertyConnectionStatus('disconnected'));\n\n          case 41:\n            _context.next = 43;\n            return (0, _effects.call)(_reduxSaga.delay, 3000);\n\n          case 43:\n            _context.next = 0;\n            break;\n\n          case 45:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _marked, this, [[14, 33]]);\n  }\n\n  exports.default = sendPing;\n});","map":[[2,0,1,0],[4,0,3,0,"exports"],[4,10,3,8,"__esModule"],[4,20,3,0],[4,23,3,21],[4,27,3,0],[6,0,5,0],[6,6,5,4,"_effects"],[6,17,5,15,"require"],[6,48,5,23],[6,68,5,15],[6,69,5,0],[8,0,7,0],[8,6,7,4,"_reduxSaga"],[8,19,7,17,"require"],[8,50,7,25],[8,62,7,17],[8,63,7,0],[10,0,9,0],[10,6,9,4,"_sagaUtils"],[10,19,9,17,"require"],[10,50,9,25],[10,72,9,17],[10,73,9,0],[12,0,11,0],[12,6,11,4,"_reducers"],[12,18,11,16,"require"],[12,49,11,24],[12,62,11,16],[12,63,11,0],[14,0,13,0],[14,6,13,4,"_serverRequest"],[14,23,13,21,"require"],[14,54,13,29],[14,78,13,21],[14,79,13,0],[16,0,15,0],[16,6,15,4,"_propsActions"],[16,22,15,20,"require"],[16,53,15,28],[16,78,15,20],[16,79,15,0],[18,0,17,0],[18,6,17,4,"_propsActions2"],[18,23,17,21,"_interopRequireDefault"],[18,46,17,44,"_propsActions"],[18,59,17,21],[18,60,17,0],[20,0,19,0],[20,6,19,4,"_chatStatuses"],[20,22,19,20,"require"],[20,53,19,28],[20,80,19,20],[20,81,19,0],[22,0,21,0],[22,6,21,4,"chatStatuses"],[22,21,21,19,"_interopRequireWildcard"],[22,45,21,43,"_chatStatuses"],[22,58,21,19],[22,59,21,0],[24,0,23,0],[24,11,23,9,"_interopRequireWildcard"],[24,34,23,0],[24,35,23,33,"obj"],[24,38,23,0],[24,40,23,38],[25,0,23,40],[25,8,23,44,"obj"],[25,15,23,51,"obj"],[25,19,23,55,"__esModule"],[25,29,23,40],[25,31,23,67],[26,0,23,69],[26,13,23,76,"obj"],[26,16,23,69],[27,0,23,82],[27,5,23,40],[27,11,23,88],[28,0,23,90],[28,10,23,94,"newObj"],[28,19,23,103],[28,21,23,90],[30,0,23,107],[30,10,23,111,"obj"],[30,17,23,118],[30,21,23,107],[30,23,23,124],[31,0,23,126],[31,13,23,131],[31,17,23,135,"key"],[31,20,23,126],[31,24,23,142,"obj"],[31,27,23,126],[31,29,23,147],[32,0,23,149],[32,14,23,153,"Object"],[32,21,23,160,"prototype"],[32,30,23,153],[32,31,23,170,"hasOwnProperty"],[32,45,23,153],[32,46,23,185,"call"],[32,50,23,153],[32,51,23,190,"obj"],[32,54,23,153],[32,56,23,195,"key"],[32,59,23,153],[32,60,23,149],[32,62,23,201,"newObj"],[32,69,23,208,"key"],[32,72,23,201],[32,76,23,215,"obj"],[32,80,23,219,"key"],[32,83,23,215],[32,84,23,201],[33,0,23,226],[34,0,23,228],[36,0,23,229,"newObj"],[36,13,23,236,"default"],[36,20,23,229],[36,23,23,246,"obj"],[36,26,23,229],[37,0,23,251],[37,13,23,258,"newObj"],[37,19,23,251],[38,0,23,267],[39,0,23,269],[41,0,25,0],[41,11,25,9,"_interopRequireDefault"],[41,33,25,0],[41,34,25,32,"obj"],[41,37,25,0],[41,39,25,37],[42,0,25,39],[42,11,25,46,"obj"],[42,18,25,53,"obj"],[42,22,25,57,"__esModule"],[42,32,25,46],[42,35,25,70,"obj"],[42,38,25,46],[42,41,25,76],[43,0,25,78,"default"],[43,15,25,87,"obj"],[44,0,25,76],[44,5,25,39],[45,0,25,95],[47,0,27,0],[47,6,27,4,"_marked"],[47,16,27,27,"regeneratorRuntime"],[47,35,27,46,"mark"],[47,39,27,27],[47,40,27,51,"sendPing"],[47,48,27,27],[47,49,27,0],[49,0,29,0],[49,6,29,4,"parseResponseToChatStatus"],[49,34,29,32],[49,43,29,41,"parseResponseToChatStatus"],[49,68,29,32],[49,69,29,67,"response"],[49,77,29,32],[49,79,29,77],[50,0,30,1],[50,11,30,8,"response"],[50,20,30,17,"agent_available"],[50,35,30,8],[50,38,30,35,"chatStatuses"],[50,51,30,48,"ONLINE"],[50,57,30,8],[50,60,30,57,"chatStatuses"],[50,73,30,70,"OFFLINE"],[50,80,30,1],[51,0,31,1],[51,3,29,0],[53,0,33,0],[53,11,33,9,"sendPing"],[53,19,33,0],[53,22,33,20],[54,0,34,1],[54,8,34,5,"license"],[54,15,34,1],[54,17,34,14,"group"],[54,22,34,1],[54,24,34,21,"visitorId"],[54,33,34,1],[54,35,34,32,"environment"],[54,46,34,1],[54,48,34,45,"requestBody"],[54,59,34,1],[54,61,34,58,"statusPingResponse"],[54,79,34,1],[54,81,34,78,"chatState"],[54,90,34,1],[54,92,34,89,"currentChatStatus"],[54,109,34,1],[54,111,34,108,"connectionStatus"],[54,127,34,1],[54,129,34,126,"_connectionStatus"],[54,146,34,1],[56,0,36,1],[56,11,36,8,"regeneratorRuntime"],[56,30,36,27,"wrap"],[56,34,36,8],[56,35,36,32],[56,44,36,41,"sendPing$"],[56,53,36,32],[56,54,36,51,"_context"],[56,62,36,32],[56,64,36,61],[57,0,37,2],[57,13,37,9],[57,14,37,2],[57,16,37,12],[58,0,38,3],[58,16,38,11,"_context"],[58,25,38,20,"prev"],[58,29,38,11],[58,32,38,27,"_context"],[58,41,38,36,"next"],[58,45,38,3],[59,0,39,4],[59,15,39,9],[59,16,39,4],[60,0,40,5],[60,16,40,9],[60,17,40,10],[60,21,40,5],[60,23,40,16],[61,0,41,6,"_context"],[61,23,41,15,"next"],[61,27,41,6],[61,30,41,22],[61,32,41,6],[62,0,42,6],[63,0,43,6],[65,0,45,5,"_context"],[65,21,45,14,"next"],[65,25,45,5],[65,28,45,21],[65,29,45,5],[66,0,46,5],[66,19,46,12],[66,20,46,13],[66,23,46,16,"_effects"],[66,32,46,25,"select"],[66,38,46,12],[66,40,46,33,"_reducers"],[66,50,46,43,"propsSelectors"],[66,64,46,33],[66,65,46,58,"getPropertyLicense"],[66,83,46,12],[66,84,46,5],[68,0,48,4],[68,15,48,9],[68,16,48,4],[69,0,49,5,"license"],[69,22,49,15,"_context"],[69,31,49,24,"sent"],[69,35,49,5],[70,0,50,5,"_context"],[70,21,50,14,"next"],[70,25,50,5],[70,28,50,21],[70,29,50,5],[71,0,51,5],[71,19,51,12],[71,20,51,13],[71,23,51,16,"_effects"],[71,32,51,25,"select"],[71,38,51,12],[71,40,51,33,"_reducers"],[71,50,51,43,"propsSelectors"],[71,64,51,33],[71,65,51,58,"getPropertyGroup"],[71,81,51,12],[71,82,51,5],[73,0,53,4],[73,15,53,9],[73,16,53,4],[74,0,54,5,"group"],[74,20,54,13,"_context"],[74,29,54,22,"sent"],[74,33,54,5],[75,0,55,5,"_context"],[75,21,55,14,"next"],[75,25,55,5],[75,28,55,21],[75,29,55,5],[76,0,56,5],[76,19,56,12],[76,20,56,13],[76,23,56,16,"_effects"],[76,32,56,25,"call"],[76,36,56,12],[76,38,56,31,"_sagaUtils"],[76,49,56,42,"waitForState"],[76,61,56,12],[76,63,56,56,"_reducers"],[76,73,56,66,"propsSelectors"],[76,87,56,56],[76,88,56,81,"getPropertyVisitorId"],[76,108,56,12],[76,109,56,5],[78,0,58,4],[78,15,58,9],[78,16,58,4],[79,0,59,5,"visitorId"],[79,24,59,17,"_context"],[79,33,59,26,"sent"],[79,37,59,5],[80,0,60,5,"_context"],[80,21,60,14,"next"],[80,25,60,5],[80,28,60,21],[80,30,60,5],[81,0,61,5],[81,19,61,12],[81,20,61,13],[81,23,61,16,"_effects"],[81,32,61,25,"select"],[81,38,61,12],[81,40,61,33,"_reducers"],[81,50,61,43,"getEnvironment"],[81,64,61,12],[81,65,61,5],[83,0,63,4],[83,15,63,9],[83,17,63,4],[84,0,64,5,"environment"],[84,26,64,19,"_context"],[84,35,64,28,"sent"],[84,39,64,5],[85,0,65,5,"requestBody"],[85,26,65,19],[86,0,66,6,"visitor"],[86,23,66,15],[87,0,67,7,"id"],[87,20,67,11,"visitorId"],[88,0,66,15],[88,15,65,19],[89,0,69,6,"skill"],[89,21,69,13,"group"],[89,26,65,19],[90,0,70,6,"random_id"],[90,25,70,17,"String"],[90,32,70,24,"Math"],[90,37,70,29,"random"],[90,43,70,24],[90,45,70,17],[91,0,65,19],[91,13,65,5],[92,0,72,5,"_context"],[92,21,72,14,"prev"],[92,25,72,5],[92,28,72,21],[92,30,72,5],[93,0,73,5,"_context"],[93,21,73,14,"next"],[93,25,73,5],[93,28,73,21],[93,30,73,5],[94,0,74,5],[94,19,74,12],[94,20,74,13],[94,23,74,16,"_effects"],[94,32,74,25,"call"],[94,36,74,12],[94,38,74,31,"_serverRequest"],[94,53,74,46,"sendPostToWebserv"],[94,70,74,12],[94,72,74,65],[94,85,74,12],[94,87,74,80],[95,0,75,6,"license"],[95,23,75,15,"license"],[95,30,74,80],[96,0,76,6,"environment"],[96,27,76,19,"environment"],[96,38,74,80],[97,0,77,6,"body"],[97,20,77,12,"requestBody"],[98,0,74,80],[98,13,74,12],[98,15,78,8],[99,0,79,6,"retry"],[99,21,79,13],[100,0,78,8],[100,13,74,12],[100,14,74,5],[102,0,82,4],[102,15,82,9],[102,17,82,4],[103,0,83,5,"statusPingResponse"],[103,33,83,26,"_context"],[103,42,83,35,"sent"],[103,46,83,5],[104,0,84,5,"_context"],[104,21,84,14,"next"],[104,25,84,5],[104,28,84,21],[104,30,84,5],[105,0,85,5],[105,19,85,12],[105,20,85,13],[105,23,85,16,"_effects"],[105,32,85,25,"select"],[105,38,85,12],[105,40,85,33,"_reducers"],[105,50,85,43,"propsSelectors"],[105,64,85,33],[105,65,85,58,"getPropertyChatStatus"],[105,86,85,12],[105,87,85,5],[107,0,87,4],[107,15,87,9],[107,17,87,4],[108,0,88,5,"chatState"],[108,24,88,17,"_context"],[108,33,88,26,"sent"],[108,37,88,5],[109,0,89,5,"currentChatStatus"],[109,32,89,25,"parseResponseToChatStatus"],[109,58,89,51,"statusPingResponse"],[109,76,89,25],[109,77,89,5],[110,0,90,5,"_context"],[110,21,90,14,"next"],[110,25,90,5],[110,28,90,21],[110,30,90,5],[111,0,91,5],[111,19,91,12],[111,20,91,13],[111,23,91,16,"_effects"],[111,32,91,25,"select"],[111,38,91,12],[111,40,91,33,"_reducers"],[111,50,91,43,"propsSelectors"],[111,64,91,33],[111,65,91,58,"getPropertyConnectionStatus"],[111,92,91,12],[111,93,91,5],[113,0,93,4],[113,15,93,9],[113,17,93,4],[114,0,94,5,"connectionStatus"],[114,31,94,24,"_context"],[114,40,94,33,"sent"],[114,44,94,5],[116,0,96,5],[116,16,96,9],[116,18,96,11,"connectionStatus"],[116,39,96,32],[116,50,96,9],[116,51,96,5],[116,53,96,46],[117,0,97,6,"_context"],[117,23,97,15,"next"],[117,27,97,6],[117,30,97,22],[117,32,97,6],[118,0,98,6],[119,0,99,6],[121,0,101,5,"_context"],[121,21,101,14,"next"],[121,25,101,5],[121,28,101,21],[121,30,101,5],[122,0,102,5],[122,19,102,12],[122,20,102,13],[122,23,102,16,"_effects"],[122,32,102,25,"put"],[122,35,102,12],[122,37,102,30,"_propsActions2"],[122,52,102,45,"default"],[122,59,102,30],[122,60,102,53,"setPropertyConnectionStatus"],[122,87,102,30],[122,88,102,81],[122,99,102,30],[122,100,102,12],[122,101,102,5],[124,0,104,4],[124,15,104,9],[124,17,104,4],[125,0,105,5],[125,16,105,9],[125,18,105,11,"chatState"],[125,32,105,25,"currentChatStatus"],[125,49,105,9],[125,50,105,5],[125,52,105,45],[126,0,106,6,"_context"],[126,23,106,15,"next"],[126,27,106,6],[126,30,106,22],[126,32,106,6],[127,0,107,6],[128,0,108,6],[130,0,110,5,"_context"],[130,21,110,14,"next"],[130,25,110,5],[130,28,110,21],[130,30,110,5],[131,0,111,5],[131,19,111,12],[131,20,111,13],[131,23,111,16,"_effects"],[131,32,111,25,"put"],[131,35,111,12],[131,37,111,30,"_propsActions2"],[131,52,111,45,"default"],[131,59,111,30],[131,60,111,53,"setPropertyChatStatus"],[131,81,111,30],[131,82,111,75,"currentChatStatus"],[131,99,111,30],[131,100,111,12],[131,101,111,5],[133,0,113,4],[133,15,113,9],[133,17,113,4],[134,0,114,5,"_context"],[134,21,114,14,"next"],[134,25,114,5],[134,28,114,21],[134,30,114,5],[135,0,115,5],[137,0,117,4],[137,15,117,9],[137,17,117,4],[138,0,118,5,"_context"],[138,21,118,14,"prev"],[138,25,118,5],[138,28,118,21],[138,30,118,5],[139,0,119,5,"_context"],[139,21,119,14,"t0"],[139,23,119,5],[139,26,119,19,"_context"],[139,35,119,28],[139,42,119,19],[139,44,119,37],[139,46,119,19],[139,47,119,5],[140,0,120,5,"_context"],[140,21,120,14,"next"],[140,25,120,5],[140,28,120,21],[140,30,120,5],[141,0,121,5],[141,19,121,12],[141,20,121,13],[141,23,121,16,"_effects"],[141,32,121,25,"select"],[141,38,121,12],[141,40,121,33,"_reducers"],[141,50,121,43,"propsSelectors"],[141,64,121,33],[141,65,121,58,"getPropertyConnectionStatus"],[141,92,121,12],[141,93,121,5],[143,0,123,4],[143,15,123,9],[143,17,123,4],[144,0,124,5,"_connectionStatus"],[144,32,124,25,"_context"],[144,41,124,34,"sent"],[144,45,124,5],[146,0,126,5],[146,16,126,9],[146,18,126,11,"_connectionStatus"],[146,40,126,33],[146,54,126,9],[146,55,126,5],[146,57,126,50],[147,0,127,6,"_context"],[147,23,127,15,"next"],[147,27,127,6],[147,30,127,22],[147,32,127,6],[148,0,128,6],[149,0,129,6],[151,0,131,5,"_context"],[151,21,131,14,"next"],[151,25,131,5],[151,28,131,21],[151,30,131,5],[152,0,132,5],[152,19,132,12],[152,20,132,13],[152,23,132,16,"_effects"],[152,32,132,25,"put"],[152,35,132,12],[152,37,132,30,"_propsActions2"],[152,52,132,45,"default"],[152,59,132,30],[152,60,132,53,"setPropertyConnectionStatus"],[152,87,132,30],[152,88,132,81],[152,102,132,30],[152,103,132,12],[152,104,132,5],[154,0,134,4],[154,15,134,9],[154,17,134,4],[155,0,135,5,"_context"],[155,21,135,14,"next"],[155,25,135,5],[155,28,135,21],[155,30,135,5],[156,0,136,5],[156,19,136,12],[156,20,136,13],[156,23,136,16,"_effects"],[156,32,136,25,"call"],[156,36,136,12],[156,38,136,31,"_reduxSaga"],[156,49,136,42,"delay"],[156,54,136,12],[156,56,136,49],[156,60,136,12],[156,61,136,5],[158,0,138,4],[158,15,138,9],[158,17,138,4],[159,0,139,5,"_context"],[159,21,139,14,"next"],[159,25,139,5],[159,28,139,21],[159,29,139,5],[160,0,140,5],[162,0,142,4],[162,15,142,9],[162,17,142,4],[163,0,143,4],[163,15,143,9],[163,20,143,4],[164,0,144,5],[164,19,144,12,"_context"],[164,28,144,21,"stop"],[164,32,144,12],[164,34,144,5],[165,0,38,3],[166,0,146,3],[167,0,147,2],[167,5,36,8],[167,7,147,4,"_marked"],[167,14,36,8],[167,16,147,13],[167,20,36,8],[167,22,147,19],[167,23,147,20],[167,24,147,21],[167,26,147,20],[167,28,147,25],[167,30,147,20],[167,31,147,19],[167,32,36,8],[167,33,36,1],[168,0,148,1],[170,0,150,0,"exports"],[170,10,150,8,"default"],[170,17,150,0],[170,20,150,18,"sendPing"],[170,28,150,0]]},"type":"js/module"}]}